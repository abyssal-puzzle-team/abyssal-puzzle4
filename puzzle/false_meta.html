<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FAlSE_META</title>
    <!-- å¼•å…¥ç¬¦åˆä¸»é¢˜çš„å­—ä½“ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,500;1,400&family=Uncial+Antiqua&display=swap" rel="stylesheet">

    <style>
        /* --- å…¨å±€ä¸ä¸»é¢˜è®¾å®š --- */
        :root {
            --parchment-bg: #f5eeda; /* ç¾Šçš®çº¸èƒŒæ™¯è‰² */
            --ink-color: #4a2c2a; /* å¢¨è¿¹é¢œè‰² */
            --highlight-color: #a47b36; /* ç¬¦å·/é«˜å…‰é¢œè‰² */
            --error-color: #9d3e3e; /* é”™è¯¯ä¿¡æ¯é¢œè‰² */
            --success-color: #4a6c4b; /* æˆåŠŸä¿¡æ¯é¢œè‰² */
            --font-title: 'Uncial Antiqua', cursive; /* æ ‡é¢˜å­—ä½“ */
            --font-body: 'EB Garamond', serif; /* æ­£æ–‡å­—ä½“ */
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background-color: #3d342a;
            background-image: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"%3E%3Cg fill-rule="evenodd"%3E%3Cg fill="%23473b2d" fill-opacity="0.4"%3E%3Cpath opacity=".5" d="M96 95h4v1h-4v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9zm-1 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v--9h-9v9zm10 0h9v-9h-9v9z"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');
            font-family: var(--font-body);
            color: var(--ink-color);
            display: flex;
            justify-content: center;
            /* MODIFIED: Align to top for long content */
            align-items: flex-start; 
            min-height: 100vh;
            /* MODIFIED: Allow scrolling and add padding */
            overflow-y: auto;
            padding: 5vh 20px;
        }

        /* --- åŠ è½½åŠ¨ç”» --- */
        #loader-wrapper {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--parchment-bg);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 1s ease-in-out;
        }

        .loader-symbol {
            font-size: 80px;
            color: var(--highlight-color);
            animation: pulse 2.5s infinite;
            margin-bottom: 20px;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                opacity: 0.7;
                text-shadow: 0 0 5px rgba(164, 123, 54, 0.3);
            }
            50% {
                transform: scale(1.1);
                opacity: 1;
                text-shadow: 0 0 15px rgba(164, 123, 54, 0.7);
            }
        }

        .loader-text {
            font-family: var(--font-title);
            font-size: 1.5rem;
            letter-spacing: 2px;
        }

        #loader-status {
            margin-top: 20px;
            font-size: 1rem;
            font-style: italic;
            color: #7a5c4a;
            letter-spacing: 1px;
        }

        /* --- è°œé¢˜ä¸»å®¹å™¨ --- */
        #puzzle-container {
            width: 90%;
            max-width: 800px; /* MODIFIED: Slightly wider for long text */
            padding: 40px 50px;
            background-color: var(--parchment-bg);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid #d4c3a2;
            border-radius: 2px;
            position: relative;
            animation: fadeInScroll 1s ease-out;
            /* MODIFIED: Use flexbox for better internal layout */
            display: flex;
            flex-direction: column;
        }
        
        @keyframes fadeInScroll {
            from { opacity: 0; transform: translateY(30px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        #puzzle-container::before,
        #puzzle-container::after {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            height: 20px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.15), transparent);
            z-index: -1;
        }
        #puzzle-container::before { top: -20px; }
        #puzzle-container::after { bottom: -20px; background: linear-gradient(to top, rgba(0,0,0,0.15), transparent); }

        /* --- è°œé¢˜å†…å®¹æ ·å¼ --- */
        .title {
            font-family: var(--font-title);
            font-size: 3rem;
            text-align: center;
            color: var(--highlight-color);
            margin-bottom: 25px;
        }

        /* ADDED: Scrollable container for the new puzzle text */
        .puzzle-content {
            width: 100%;
            max-height: 45vh;
            overflow-y: auto;
            background: rgba(0,0,0,0.02);
            border-top: 1px solid rgba(74, 44, 42, 0.2);
            border-bottom: 1px solid rgba(74, 44, 42, 0.2);
            padding: 20px;
            margin-bottom: 30px;
            text-align: left;
            white-space: pre-wrap;
            line-height: 1.7;
            font-size: 1.05rem;
        }
        
        /* ADDED: Custom scrollbar for puzzle content */
        .puzzle-content::-webkit-scrollbar {
            width: 10px;
        }
        .puzzle-content::-webkit-scrollbar-track {
            background: rgba(74, 44, 42, 0.05);
            border-radius: 5px;
        }
        .puzzle-content::-webkit-scrollbar-thumb {
            background-color: rgba(164, 123, 54, 0.4);
            border-radius: 5px;
            border: 2px solid transparent;
            background-clip: content-box;
        }
        .puzzle-content::-webkit-scrollbar-thumb:hover {
            background-color: var(--highlight-color);
        }

        .input-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px; /* MODIFIED: Adjusted margin */
        }

        #key-input {
            width: 100%;
            max-width: 400px;
            background-color: transparent;
            border: none;
            border-bottom: 2px solid rgba(74, 44, 42, 0.3);
            color: var(--ink-color);
            padding: 10px 5px;
            font-family: var(--font-body);
            font-style: italic;
            font-size: 1.4rem;
            text-align: center;
            transition: all 0.4s ease;
        }

        #key-input:focus {
            outline: none;
            border-bottom-color: var(--ink-color);
            box-shadow: 0 5px 15px -10px rgba(74, 44, 42, 0.5);
        }

        #key-input::placeholder {
            color: rgba(74, 44, 42, 0.4);
            font-style: italic;
        }
        
        #submit-key {
            margin-top: 30px;
            padding: 10px 30px;
            background-color: transparent;
            border: none;
            color: var(--highlight-color);
            font-family: var(--font-title);
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            letter-spacing: 1px;
            text-shadow: 0 0 8px rgba(164, 123, 54, 0); 
        }
        
        #submit-key:not(:disabled):hover, 
        #submit-key:not(:disabled):focus {
            color: var(--ink-color);
            transform: translateY(-2px);
            text-shadow: 0 0 8px rgba(164, 123, 54, 0.5);
        }
        
        #submit-key:disabled {
            color: #9e8a70;
            cursor: not-allowed;
            transform: none;
            text-shadow: none;
        }

        .message {
            margin-top: 25px;
            min-height: 24px;
            text-align: center;
            font-size: 1rem;
            font-style: italic;
            transition: color 0.5s;
        }

        .message.success { color: var(--success-color); }
        .message.error { color: var(--error-color); }
    </style>
</head>
<body>

    <!-- åŠ è½½åŠ¨ç”» -->
    <div id="loader-wrapper">
        <div class="loader-symbol">âœ§</div>
        <p class="loader-text">éªŒè¯ä¸­</p>
        <p id="loader-status"></p>
    </div>

    <!-- è°œé¢˜ä¸»å†…å®¹ (é»˜è®¤éšè—) -->
    <main id="puzzle-container" style="display: none;">
        <h1 class="title">False Meta</h1>
        
        <!-- MODIFIED: Puzzle text is now in a scrollable container -->
        <div class="puzzle-content">
[Insight]
Charter:ã€ŒThe Collapsing DATAã€-Err0r Insight-

Story:
"Cryst,æˆ‘å¸®ä½ äº‰å–æ—¶é—´,å…¶å®ƒéƒ½äº¤ç»™æˆ‘å°±å¥½,ä½ å°½å¿«å¯åŠ¨é˜²å¾¡ç¨‹åº!"
Crystç›®ä¸è½¬ç›ç›¯ç€å±å¹•,å¼€å§‹æœå¯»æœ‰å…³ä¿¡æ¯...
æ¡Œé¢æ–‡ä»¶ä¸Šæœ‰ä¸€ä¸ªåä¸º"é˜²å¾¡ç¨‹åº"çš„æ–‡ä»¶å¤¹,ä½†ä¼¼ä¹å—æ··æ²Œå½±å“å·²ç»ç¼–æ’æ··ä¹±,Crystç‚¹è¿›å»å¼€å§‹ç ”ç©¶...
            
å‡Metaæ­£æ–‡:
â€¢é˜²å¾¡ç¨‹åº(æ¡Œé¢æ–‡ä»¶å¤¹)
>Crystç‚¹è¿›è¿™ä¸ªæ–‡ä»¶å¤¹,
â€¢____1 1__1_ ___11 1__11 1_11_(è®°äº‹æœ¬,ç¼–è¾‘è€…Lephon)
â€¢Pack A(è®°äº‹æœ¬è°±é¢ç¼–è¾‘è€…) 600æ˜Ÿé’» å·²è´­ä¹°(è®°äº‹æœ¬)
â€¢Pack A(æ–‡ä»¶å¤¹)
>Crystç»§ç»­ç‚¹è¿›Pack Aæ–‡ä»¶å¤¹
â€¢ğŸ‘âœŠ(IV)-ğŸ‘(I)-ğŸ§ (I)+ğŸŒ¿ğŸ’£(I)(Wordæ–‡æ¡£,åˆ›å»ºè€…åä¸ºCatastrophe)
â€¢"é‚£é¦–æ­Œæ˜¯æ˜Ÿç©ºä¸­çš„å¯ç¤ºå½•,è®°å½•ç€å®‡å®™ä¸­çš„åœ°ç‹±ä¹‹ç«,è·ç¦»å”¯ä¸€çš„æœ€é«˜å³°ä»…å·®æ¯«å˜,æ‹¥æœ‰ä»¤äººè¯§å¼‚çš„ç‹¬ç‰¹é£æ ¼"(è®°äº‹æœ¬)
â€¢"ä»£å·:ç–¯ç‹‚(ç ”ç©¶å•ä½:ç¢æ•°ç ”) "é‚£ä¸€å¹´çš„XMAS,æ²¡æœ‰äººæƒ³åˆ°å®ƒä¼šåœ¨ä¸è¿œçš„å°†æ¥å›å½’,ä»¥å¦ä¸€ç§å½¢å¼."(éŸ³é¢‘)
â€¢"ä»£å·:æš´é›¨"(ç ”ç©¶è€…:"å¤å‘³é¸­") "æ­»äº¡ä¹‹é›¨è½ä¸‹ è¡€è…¥ä¹‹æ—¥æ¥ä¸´ å°–å«å£°å››èµ· æ··ä¹±æ’’ä¸Šä¹¦æ¡Œ..."(éŸ³é¢‘)
â€¢"çŸ­æš‚çš„ç–¯ç‹‚,é•¿ä¹…çš„æš´é›¨."(PPTæ ‡é¢˜)
â€¢æ•°æ®ä¼ è¾“é¢‘ç‡ç³»ç»Ÿ.exe(ç¨‹åº)
>CrystæŸ¥çœ‹äº†æ•°æ®ä¼ è¾“é¢‘ç‡ç¨‹åº:"æˆ‘æ‡‚äº†,è¿™ä¸ªå­æ–‡ä»¶å¤¹é‡ŒWordæ–‡æ¡£å’Œè®°äº‹æœ¬æ•°æ®ä¼ è¾“é¢‘ç‡ä¸åŒ,çœ‹æ¥è¦å…ˆæ‰¾å‡ºå®ƒä»¬ç­‰æ•ˆçš„'åŒé¢‘å…±æŒ¯'çš„ç¬é—´,ä¹Ÿå°±æ˜¯??:??å’Œ??:??",ç„¶åå†æŠŠä¸¤ä»½æ›¿ä»£ç”¨éŸ³é¢‘æ•°æ®çš„æ•°æ®æ€»é‡mä¸nåˆ†åˆ«å¯¹åº”è®¾å®šä¸ºé‚£ä¸¤ä¸ªç¬é—´æ—¶çš„æ•°æ®æ€»é‡m1ä¸n1(æˆ‘éœ€è¦èƒ½å¸®æˆ‘ç¡®å®šå¯¹åº”æƒ…å†µçš„ä¿¡æ¯),ç„¶åä¸ºé˜²æ­¢è¯¯å·®æŠŠè¿™ä¸¤ä¸ªæ•°æ®æ€»é‡å››èˆäº”å…¥å¾—åˆ°Aä¸B,å°±èƒ½ç›´æ¥å¡«å…¥ä½¿å¾—æ•°æ®ä¼ è¾“ç¨³å®šäº†."
>éšå,Crstå°†ä¸¤ä¸ªæ•°å­—å¡«å…¥ç¨‹åº,æ–‡ä»¶å¤¹é‡Œå‡ºç°äº†ä¸€ä¸ªæ–°å­æ–‡ä»¶å¤¹(åä¸º"é˜²å¾¡ç³»ç»Ÿè®¿é—®ä¸­æ¢"),Crystå†æ¬¡ç‚¹å‡»è¿›å…¥â€”â€”
â€¢Z=|A-B|;(è®°äº‹æœ¬)
â€¢Y=The Creator of the Key of "Ambivalent Vision"(è®°äº‹æœ¬)
â€¢X=Z/10+80;(è®°äº‹æœ¬)
â€¢é˜²å¾¡ç³»ç»Ÿå¼€å¯.exe(ç¨‹åº)
>Crystç‚¹è¿›é˜²å¾¡ç³»ç»Ÿå¼€å¯ç¨‹åºç¨‹åº,çœ‹åˆ°äº†å¦‚ä¸‹é¡µé¢:
<ç§»åŠ¨ç«¯é˜²å¾¡ç³»ç»Ÿè®¿é—®æƒé™æ£€æµ‹>
è®¿é—®è€…(X):-46/-4/-6/+3/-14
éš¾åº¦å¯†é’¥:âˆšY(Y,âˆ‰N*,âˆšY,turn to N*)
è®¿é—®å¯†é’¥:________________(å¾…å¡«å†™)
[Enter]

>"çœ‹æ¥è¦æ‰¾åˆ°è®¿é—®è€…çš„åå­—è¦åˆ©ç”¨'X',è¿˜è¦æ‰¾å¯¹è§£è°œæ–¹å¼,åŒæ—¶ç»“åˆéš¾åº¦å¯†é’¥æ¨æ–­æœ€ç»ˆçš„è®¿é—®å¯†é’¥,ä¹‹åæ‰èƒ½å¯åŠ¨é˜²å¾¡ç³»ç»Ÿ,çœŸçƒ§è„‘â€¦"Crystçš±äº†çš±çœ‰å¤´,å¼€å§‹å°è¯•èµ·æ¥... </div>

        <div class="input-group">
            <input type="text" id="key-input" name="key" placeholder="åœ¨æ­¤è¾“å…¥" autocomplete="off">
            <button id="submit-key">æäº¤</button>
        </div>
        
        <div id="message-area" class="message">
            â€” å°å°é™é»˜ç€ï¼Œç­‰å¾…ç€æ­£ç¡®çš„å¯†è¯­ä¸æ—¶æœºã€‚ â€”
        </div>
    </main>

    <script>
        // ===================================================================
        // ===================    API æ¥å£é…ç½®åŒº   =======================
        // ===================================================================
        const API_BASE_URL = 'https://abyssal4.asterveil.top/api'; 
        const API_PATHS = {
            accCheck: '/acc_check_password',
            checkKey: '/check-key',
            setUserData: '/set_user_data'
        };
        
        // ===================================================================
        // ===================      è„šæœ¬ä¸»é€»è¾‘      =======================
        // ===================================================================

        document.addEventListener('DOMContentLoaded', () => {

            const loaderWrapper = document.getElementById('loader-wrapper');
            const loaderStatus = document.getElementById('loader-status');
            const puzzleContainer = document.getElementById('puzzle-container');
            const keyInput = document.getElementById('key-input');
            const submitKeyBtn = document.getElementById('submit-key');
            const messageArea = document.getElementById('message-area');
            
            function getApiUrl(pathKey) {
                return `${API_BASE_URL}${API_PATHS[pathKey]}`;
            }

            function getCookie(name) {
                const value = `; ${document.cookie}`;
                const parts = value.split(`; ${name}=`);
                if (parts.length === 2) return parts.pop().split(';').shift();
                return null;
            }

            async function handlePageLoad() {
                const username = getCookie('username');
                const password = getCookie('password');

                if (!username || !password) {
                    window.location.href = '../index.html';
                    return;
                }

                loaderStatus.textContent = 'æ­£åœ¨åˆ¤æ–­è´¦æˆ·è¿›åº¦...';

                try {
                    const response = await fetch(getApiUrl('accCheck'), {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ username, password })
                    });
                    
                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({ message: 'è´¦æˆ·éªŒè¯å¤±è´¥ï¼Œè¯·é‡æ–°ç™»å½•ã€‚' }));
                        alert(errorData.message);
                        window.location.href = '../index.html';
                        return;
                    }
                    
                    const data = await response.json();

                    if (data.success) {
                        const progress = data.user_data.progress;
                        if (progress === '8') { 
                            window.location.href = '../storyline/insight/false_meta.html';
                        } else if (progress === '7') {
                            showPuzzle();
                        } else {
                            window.location.href = '../main.html';
                        }
                    } else {
                        alert(data.message || 'è´¦æˆ·éªŒè¯å¤±è´¥ï¼Œè¯·é‡æ–°ç™»å½•ã€‚');
                        window.location.href = '../index.html';
                    }
                } catch (error) {
                    console.error('éªŒè¯APIè¯·æ±‚å¤±è´¥:', error);
                    loaderStatus.textContent = 'é”™è¯¯ï¼šä¸ä¸Šå¤æœåŠ¡å™¨çš„è¿æ¥ä¸­æ–­ã€‚';
                    alert('ç½‘ç»œå¼‚å¸¸ï¼Œæ— æ³•éªŒè¯ä½ çš„èº«ä»½ã€‚è¯·æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°(F12)çš„é”™è¯¯ä¿¡æ¯ã€‚');
                    setTimeout(() => window.location.href = '../index.html', 3000);
                }
            }

            function showPuzzle() {
                loaderWrapper.style.opacity = '0';
                setTimeout(() => {
                    loaderWrapper.style.display = 'none';
                    puzzleContainer.style.display = 'flex'; // Use flex to match CSS
                }, 1000);
            }
            
            async function handleKeySubmission() {
                const now = new Date();
                const currentSecond = now.getSeconds();
                if (currentSecond !== 8 && currentSecond !== 29) {
                    showMessage('æœªåœ¨æ•°æ®ç¨³å®šæ—¶è¾“å…¥', 'error');
                    return;
                }

                const key = keyInput.value.trim();
                const username = getCookie('username');
                
                if (!key) {
                    showMessage('ä¸å¯ä¸ºç©ºã€‚', 'error');
                    return;
                }
                
                if (!username) {
                    alert('èº«ä»½å°è®°å·²æ¨¡ç³Šï¼Œè¯·é‡æ–°ç™»å½•ã€‚');
                    window.location.href = '../index.html';
                    return;
                }
                
                showMessage('éªŒè¯ä¸­', '');
                submitKeyBtn.disabled = true;

                try {
                    const response = await fetch(getApiUrl('checkKey'), {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ nodeId: 'false_meta', key: key })
                    });
                    
                    const data = await response.json();
                    
                    if (response.ok && data.success) {
                        showMessage('å°å°è§£å¼€ï¼æ­£åœ¨è®°å½•ä½ çš„åŠŸç»©...', 'success');
                        await updateUserProgressAndRedirect(username);
                    } else {
                        const userFriendlyMessage = data.message
                            .replace("å¯†é’¥é”™è¯¯ï¼Œå·²è§¦å‘å†·å´ã€‚", "å¯†è¯­é”™è¯¯ï¼Œä½ æ„Ÿåˆ°ä¸€é˜µç²¾ç¥ç–²åŠ³ã€‚")
                            .replace("è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•ã€‚", "å’å”±è¿‡äºé¢‘ç¹ï¼Œä½ éœ€è¦ä¼‘æ¯ç‰‡åˆ»ã€‚");
                        
                        if (data.cooldown) {
                            startCooldownTimer(data.cooldown, userFriendlyMessage);
                        } else {
                            showMessage(userFriendlyMessage, 'error');
                            submitKeyBtn.disabled = false;
                        }
                    }

                } catch(error) {
                    console.error('å¯†é’¥æ£€æŸ¥APIè¯·æ±‚å¤±è´¥:', error);
                    showMessage('é”™è¯¯ï¼šè™šç©ºå¹²æ‰°äº†ä½ çš„å’å”±ã€‚', 'error');
                    submitKeyBtn.disabled = false;
                }
            }

            async function updateUserProgressAndRedirect(username) {
                try {
                    const response = await fetch(getApiUrl('setUserData'), {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ username: username, option: 'progress', value: '8' })
                    });
                    
                    const data = await response.json();

                    if (response.ok && data.success) {
                        showMessage('å†å²å·²è¢«é“­è®°ï¼Œæ–°çš„ç¯‡ç« å³å°†å±•å¼€...', 'success');
                        setTimeout(() => {
                            window.location.href = '../storyline/insight/false_meta.html';
                        }, 2000);
                    } else {
                        showMessage(`è®°å½•å¤±è´¥: ${data.message}`, 'error');
                        submitKeyBtn.disabled = false;
                    }

                } catch (error) {
                    console.error('è®¾ç½®ç”¨æˆ·æ•°æ®APIè¯·æ±‚å¤±è´¥:', error);
                    showMessage('é”™è¯¯ï¼šæ— æ³•å°†ä½ çš„äº‹è¿¹è½½å…¥å²å†Œã€‚', 'error');
                    submitKeyBtn.disabled = false;
                }
            }

            function showMessage(msg, type) {
                messageArea.textContent = `â€” ${msg} â€”`;
                messageArea.className = `message ${type}`;
            }

            function startCooldownTimer(seconds, initialMessage) {
                let remaining = seconds;
                keyInput.disabled = true;
                submitKeyBtn.disabled = true;

                const interval = setInterval(() => {
                    if (remaining > 0) {
                        showMessage(`${initialMessage} (${remaining}s)`, 'error');
                        remaining--;
                    } else {
                        clearInterval(interval);
                        showMessage('ä½ å¯ä»¥å†æ¬¡å°è¯•äº†ã€‚', '');
                        submitKeyBtn.disabled = false;
                        keyInput.disabled = false;
                    }
                }, 1000);
            }
            
            submitKeyBtn.addEventListener('click', handleKeySubmission);
            keyInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !submitKeyBtn.disabled) {
                    handleKeySubmission();
                }
            });

            handlePageLoad();
        });
    </script>
</body>
</html>