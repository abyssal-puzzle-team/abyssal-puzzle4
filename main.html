<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>知识星图 - 玩家进度</title>
    <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <style>
        /* 全局变量 */
        :root {
            --bg-color: linear-gradient(135deg, #0e1724 0%, #131c2e 30%, #0d1a2e 100%);
            --dark-accent: #0b121d;
            --line-color: #30363d;
            --accent-glow: #2eb4e9;
            --accent-fill: #58a6ff;
            --node-locked-fill: #21262d;
            --text-primary: #e3f4ff;
            --text-secondary: #87b3d1;
            --star-glow: rgba(46, 180, 233, 0.7);
            --node-pulse: #2eb4e9;
        }
        
        /* 基础样式重置 */
        *, *::before, *::after {
            box-sizing: border-box; 
            margin: 0; 
            padding: 0;
        }
        
        /* 页面整体样式 */
        body {
            background: var(--bg-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            font-family: 'Source Code Pro', monospace;
            color: var(--text-primary);
            position: relative;
        }
        
        /* 星星背景效果 */
        .starfield {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .star {
            position: absolute;
            width: 3px;
            height: 3px;
            background-color: var(--text-primary);
            border-radius: 50%;
            box-shadow: 0 0 10px 2px var(--star-glow);
            animation: twinkle 5s infinite;
        }
        
        /* 容器和卡片 */
        .dashboard {
            width: 92%;
            max-width: 1400px;
            padding: 2rem;
            border-radius: 20px;
            background: rgba(12, 23, 38, 0.6);
            border: 1px solid rgba(46, 180, 233, 0.15);
            box-shadow: 0 10px 40px rgba(46, 180, 233, 0.1);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(5px);
        }
        
        .dashboard::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--accent-glow);
            box-shadow: 0 0 12px 2px var(--accent-glow);
            animation: scanning 8s infinite;
        }
        
        /* 进度标题 */
        .header {
            text-align: center;
            margin-bottom: 2.5rem;
            position: relative;
            z-index: 2;
        }
        
        .title {
            font-size: 2.5rem;
            font-weight: 600;
            letter-spacing: 3px;
            text-transform: uppercase;
            margin-bottom: 0.5rem;
            text-shadow: 0 0 15px var(--accent-glow);
            background: linear-gradient(90deg, #b4e1ff, #58a6ff, #2eb4e9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: inline-block;
            animation: title-glow 3s infinite alternate;
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            letter-spacing: 1px;
        }
        
        .progress-indicator {
            font-size: 1.2rem;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 1rem;
        }
        
        .percentage {
            color: var(--accent-glow);
            font-weight: 600;
            margin: 0 8px;
            text-shadow: 0 0 8px rgba(46, 180, 233, 0.8);
        }
        
        .progress-bar {
            width: 60%;
            height: 6px;
            background: var(--dark-accent);
            border-radius: 10px;
            margin: 0 auto;
            overflow: hidden;
            box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.5);
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-fill), var(--accent-glow));
            box-shadow: 0 0 10px var(--accent-glow);
            width: 0%;
            border-radius: 10px;
            transition: width 1.5s ease-out;
        }
        
        /* SVG进度图 */
        .progress-wrapper {
            position: relative;
            width: 100%;
            opacity: 0;
        }
        
        .progress-svg {
            width: 100%;
            height: 340px;
            overflow: visible;
        }
        
        .progress-line {
            stroke-width: 4;
            stroke-linecap: round;
            fill: none;
        }
        
        .progress-line-bg {
            stroke: var(--line-color);
            opacity: 0.4;
        }
        
        .progress-line-unlocked {
            stroke: url(#line-gradient);
            stroke-linecap: round;
            filter: url(#line-glow);
            stroke-width: 5;
        }
        
        /* 节点样式 */
        .node {
            stroke-width: 2.5;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform-origin: center center;
            fill: var(--node-locked-fill);
            stroke: var(--line-color);
            cursor: not-allowed;
            filter: url(#node-shadow);
        }
        
        .node-label {
            font-size: 14px;
            fill: rgba(200, 220, 255, 0.8);
            font-weight: 600;
            text-transform: uppercase;
            pointer-events: none;
            text-anchor: middle;
            dominant-baseline: middle;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .node.unlocked {
            fill: var(--accent-fill);
            stroke: rgba(255, 255, 255, 0.9);
            cursor: pointer;
            filter: url(#node-glow);
        }
        
        .node.unlocked ~ .node-label {
            opacity: 1;
        }
        
        /* 动态光标轨迹 */
        .cursor-trail {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: radial-gradient(circle, #2eb4e9, transparent);
            pointer-events: none;
            filter: blur(8px);
            transform: translate(-50%, -50%);
            z-index: 1;
            opacity: 0;
        }
        
        /* 悬停按钮效果 */
        a:hover .node.unlocked,
        a:focus .node.unlocked {
            transform: scale(1.3);
            filter: url(#intensive-glow);
            box-shadow: 0 0 25px var(--accent-glow);
        }
        
        /* 节点脉冲动画 */
        .node-pulse {
            position: absolute;
            border-radius: 50%;
            pointer-events: none;
            z-index: -1;
        }
        
        /* 响应式调整 */
        @media (max-width: 768px) {
            .title {
                font-size: 1.8rem;
            }
            
            .subtitle {
                font-size: 1rem;
            }
            
            .progress-bar {
                width: 80%;
            }
            
            .progress-svg {
                height: 220px;
            }
        }
        
        /* 关键帧动画 */
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        
        @keyframes scanning {
            0% { transform: translateY(0); }
            50% { transform: translateY(calc(100vh - 10px)); }
            100% { transform: translateY(0); }
        }
        
        @keyframes pulse {
            0% { 
                transform: scale(0.8); 
                opacity: 0.8;
            }
            100% { 
                transform: scale(2.5); 
                opacity: 0;
            }
        }
        
        @keyframes glow-pulse {
            0% { 
                box-shadow: 0 0 0 0 rgba(46, 180, 233, 0.7);
            }
            70% { 
                box-shadow: 0 0 0 15px rgba(46, 180, 233, 0);
            }
            100% { 
                box-shadow: 0 0 0 0 rgba(46, 180, 233, 0);
            }
        }
        
        @keyframes title-glow {
            from { text-shadow: 0 0 15px rgba(46, 180, 233, 0.7); }
            to { text-shadow: 0 0 25px rgba(46, 180, 233, 0.9); }
        }
        
        @keyframes line-flow {
            to { stroke-dashoffset: -40; }
        }
    </style>
</head>
<body>
    <!-- 动态粒子背景 -->
    <div class="starfield"></div>
    
    <!-- 光标轨迹 -->
    <div class="cursor-trail"></div>
    
    <div class="dashboard">
        <div class="header">
            <!-- 标题区 -->
            <div class="title">知识星图</div>
            <div class="subtitle">星际探索与智慧进化的旅程</div>
            
            <!-- 百分比进度条 -->
            <div class="progress-indicator">
                <span>探索进度:</span>
                <span class="percentage" id="progress-text">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-bar"></div>
            </div>
        </div>
        
        <!-- 进度图容器 -->
        <div class="progress-wrapper">
            <svg class="progress-svg" viewbox="0 0 1400 340">
                <defs>
                    <!-- 线条光效 -->
                    <filter id="line-glow" x="-40%" y="-40%" width="180%" height="180%">
                        <feGaussianBlur stdDeviation="3" result="coloredBlur"></feGaussianBlur>
                        <feMerge>
                            <feMergeNode in="coloredBlur"></feMergeNode>
                            <feMergeNode in="SourceGraphic"></feMergeNode>
                        </feMerge>
                    </filter>
                    
                    <!-- 节点光效 -->
                    <filter id="node-glow" x="-50%" y="-50%" width="200%" height="200%">
                        <feGaussianBlur stdDeviation="8" result="blur"></feGaussianBlur>
                        <feColorMatrix in="blur" type="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 19 -9" result="glow"></feColorMatrix>
                        <feComposite in="SourceGraphic" in2="glow" operator="over"/>
                    </filter>
                    
                    <!-- 强光效 -->
                    <filter id="intensive-glow" x="-60%" y="-60%" width="220%" height="220%">
                        <feGaussianBlur stdDeviation="15" result="coloredBlur"></feGaussianBlur>
                        <feMerge>
                            <feMergeNode in="coloredBlur"></feMergeNode>
                            <feMergeNode in="SourceGraphic"></feMergeNode>
                        </feMerge>
                    </filter>
                    
                    <!-- 节点阴影 -->
                    <filter id="node-shadow">
                        <feDropShadow dx="0" dy="0" stdDeviation="2" flood-color="rgba(0, 0, 0, 0.5)"></feDropShadow>
                    </filter>
                    
                    <!-- 渐变线条 -->
                    <linearGradient id="line-gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" stop-color="#22a7f0"/>
                        <stop offset="40%" stop-color="#58a6ff"/>
                        <stop offset="100%" stop-color="#2eb4e9"/>
                    </linearGradient>
                    
                    <!-- 节点图案 -->
                    <pattern id="node-pattern" patternUnits="objectBoundingBox" width="100%" height="100%">
                        <circle cx="50%" cy="50%" r="45%" fill="#162a45" stroke="#2eb4e9" stroke-width="5"/>
                    </pattern>
                </defs>
                
                <!-- 基础连接线 -->
                <line class="progress-line progress-line-bg" x1="150" y1="70"  x2="350" y2="170"></line>
                <line class="progress-line progress-line-bg" x1="150" y1="270" x2="350" y2="170"></line>
                <line class="progress-line progress-line-bg" x1="350" y1="170" x2="1250" y2="170"></line>
                
                <!-- 已解锁连接线 -->
                <line class="progress-line progress-line-unlocked" id="line-a-3" x1="150" y1="70"  x2="350" y2="170"></line>
                <line class="progress-line progress-line-unlocked" id="line-b-3" x1="150" y1="270" x2="350" y2="170"></line>
                <line class="progress-line progress-line-unlocked" id="line-3-4" x1="350" y1="170" x2="530" y2="170"></line>
                <line class="progress-line progress-line-unlocked" id="line-4-5" x1="530" y1="170" x2="710" y2="170"></line>
                <line class="progress-line progress-line-unlocked" id="line-5-6" x1="710" y1="170" x2="890" y2="170"></line>
                <line class="progress-line progress-line-unlocked" id="line-6-7" x1="890" y1="170" x2="1070" y2="170"></line>
                <line class="progress-line progress-line-unlocked" id="line-7-8" x1="1070" y1="170" x2="1250" y2="170"></line>
                
                <!-- 节点组 -->
                <g class="node-group">
                    <a href="#" id="link-node-a">
                        <g>
                            <circle id="node-a" class="node" cx="150" cy="70" r="24"></circle>
                            <text class="node-label" x="150" y="70">Alpha</text>
                        </g>
                    </a>
                    
                    <a href="#" id="link-node-b">
                        <g>
                            <circle id="node-b" class="node" cx="150" cy="270" r="24"></circle>
                            <text class="node-label" x="150" y="270">Beta</text>
                        </g>
                    </a>
                    
                    <a href="#" id="link-node-3">
                        <g>
                            <circle id="node-3" class="node" cx="350" cy="170" r="26"></circle>
                            <text class="node-label" x="350" y="170">Γ3</text>
                        </g>
                    </a>
                    
                    <a href="#" id="link-node-4">
                        <g>
                            <circle id="node-4" class="node" cx="530" cy="170" r="26"></circle>
                            <text class="node-label" x="530" y="170">Σ4</text>
                        </g>
                    </a>
                    
                    <a href="#" id="link-node-5">
                        <g>
                            <circle id="node-5" class="node" cx="710" cy="170" r="26"></circle>
                            <text class="node-label" x="710" y="170">Ω5</text>
                        </g>
                    </a>
                    
                    <a href="#" id="link-node-6">
                        <g>
                            <circle id="node-6" class="node" cx="890" cy="170" r="26"></circle>
                            <text class="node-label" x="890" y="170">Π6</text>
                        </g>
                    </a>
                    
                    <a href="#" id="link-node-7">
                        <g>
                            <circle id="node-7" class="node" cx="1070" cy="170" r="26"></circle>
                            <text class="node-label" x="1070" y="170">Ψ7</text>
                        </g>
                    </a>
                    
                    <a href="#" id="link-node-8">
                        <g>
                            <circle id="node-8" class="node" cx="1250" cy="170" r="26"></circle>
                            <text class="node-label" x="1250" y="170">Ω8</text>
                        </g>
                    </a>
                </g>
                
                <!-- 中心亮点 -->
                <circle cx="350" cy="170" r="8" fill="#ffffff" filter="url(#intensive-glow)">
                    <animate attributeName="r" values="8;13;8" dur="2s" repeatCount="indefinite"/>
                </circle>
            </svg>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const API_BASE_URL = 'http://111.170.11.168:15114/proxy/3000';
    
    // 动态生成星星背景
    function createStarfield() {
        const starfield = document.querySelector('.starfield');
        const starsCount = Math.floor(window.innerWidth * window.innerHeight / 2000);
        
        for (let i = 0; i < starsCount; i++) {
            const star = document.createElement('div');
            star.classList.add('star');
            star.style.top = `${Math.random() * 100}%`;
            star.style.left = `${Math.random() * 100}%`;
            star.style.animationDelay = `${Math.random() * 5}s`;
            star.style.opacity = `${Math.random() * 0.6 + 0.1}`;
            starfield.appendChild(star);
        }
    }
    
    // 光标轨迹效果
    function createCursorTrail() {
        const cursor = document.querySelector('.cursor-trail');
        
        document.addEventListener('mousemove', (e) => {
            const x = e.clientX;
            const y = e.clientY;
            
            cursor.style.left = `${x}px`;
            cursor.style.top = `${y}px`;
            cursor.style.opacity = '0.7';
            cursor.style.transition = 'opacity 0.3s';
            
            setTimeout(() => {
                cursor.style.transition = 'opacity 1.5s ease-out';
                cursor.style.opacity = '0';
            }, 100);
        });
    }
    
    // 添加节点脉冲效果
    function addNodePulseEffect() {
        const nodes = document.querySelectorAll('.node.unlocked');
        nodes.forEach(node => {
            const pulse = document.createElement('div');
            pulse.className = 'node-pulse';
            pulse.style.width = `${node.r.baseVal.value * 6}px`;
            pulse.style.height = `${node.r.baseVal.value * 6}px`;
            pulse.style.left = `${node.cx.baseVal.value}px`;
            pulse.style.top = `${node.cy.baseVal.value}px`;
            
            const nodeRect = node.getBoundingClientRect();
            pulse.style.left = `${nodeRect.left + window.scrollX}px`;
            pulse.style.top = `${nodeRect.top + window.scrollY}px`;
            pulse.style.animation = `pulse 3s infinite`;
            
            document.body.appendChild(pulse);
        });
    }
    
    // 常规的cookies处理
    function getCookie(name) {
        const nameEQ = name + "=";
        const ca = document.cookie.split(';');
        for(let c of ca) {
            c = c.trim();
            if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
        }
        return null;
    }

    // 登出重定向
    function redirectToLogin() {
        window.location.href = 'index.html';
    }
    
    // 进度条动画
    function updateProgressBar(progress) {
        const percentage = Math.round((progress / 8) * 100);
        document.getElementById('progress-text').textContent = `${percentage}%`;
        document.getElementById('progress-bar').style.width = `${percentage}%`;
    }

    // 进度可视化动画
    function animateProgress(progress) {
        anime({ 
            targets: '.progress-wrapper', 
            opacity: [0, 1], 
            duration: 1200, 
            easing: 'easeOutExpo' 
        });

        anime({ 
            targets: '.progress-line-unlocked', 
            strokeDashoffset: [anime.setDashoffset, 0], 
            duration: 0 
        });

        const tl = anime.timeline({ 
            easing: 'easeInOutQuad', 
            duration: 900 
        });

        if (progress >= 1) {
            tl.add({ 
                targets: ['#node-a', '#node-b'], 
                scale: [0, 1.1, 1], 
                opacity: [0, 1],
                complete: (anim) => anim.animatables.forEach(a => {
                    a.target.classList.add('unlocked');
                    addNodePulseEffect();
                })
            });
        }
        
        if (progress >= 3) {
            tl.add({ targets: ['#line-a-3', '#line-b-3'], strokeDashoffset: [anime.setDashoffset, 0] })
              .add({ targets: '#node-3', scale: [0, 1.1, 1], opacity: [0, 1],
                complete: () => {
                    document.getElementById('node-3').classList.add('unlocked');
                    addNodePulseEffect();
                }
            }, '-=200');
        }

        // 设置后续节点的动画
        for (let i = 4; i <= 8; i++) {
            if (progress >= i) {
                tl.add({ 
                    targets: `#line-${i-1}-${i}`, 
                    strokeDashoffset: [anime.setDashoffset, 0], 
                    duration: 600 
                }, '-=200')
                .add({ 
                    targets: `#node-${i}`, 
                    scale: [0, 1.1, 1], 
                    opacity: [0, 1], 
                    duration: 700,
                    complete: () => {
                        document.querySelector(`#node-${i}`).classList.add('unlocked');
                        addNodePulseEffect();
                    }
                }, '-=250');
            }
        }
        
        // 更新顶部进度条
        updateProgressBar(progress);
    }

    // 主流程函数
    async function main() {
        const username = getCookie('username');
        const password = getCookie('password');

        if (!username || !password) {
            redirectToLogin();
            return;
        }

        try {
            const response = await fetch(`${API_BASE_URL}/acc_check_password`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password }),
                credentials: 'include'
            });

            if (!response.ok) throw new Error('Authentication failed');

            const data = await response.json();

            if (data.success && data.user_data) {
                const progress = parseInt(data.user_data.progress, 10);
                if (progress === 9) {
                    window.location.href = './puzzle/end.html';
                    return;
                }
                animateProgress(progress);
            } else {
                throw new Error(data.message || 'Invalid credentials');
            }
        } catch (error) {
            console.error('Main process failed:', error);
            redirectToLogin();
        }
    }
    
    // 初始化
    createStarfield();
    createCursorTrail();
    main();
});
</script>
</body>
</html>